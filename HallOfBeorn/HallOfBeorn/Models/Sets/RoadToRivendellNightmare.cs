using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace HallOfBeorn.Models.Sets
{
    public class RoadToRivendellNightmare : CardSet
    {
        protected override void Initialize()
        {
            Name = "Road to Rivendell Nightmare";
            Abbreviation = "RtRN";
            SetType = Models.SetType.Nightmare_Expansion;
            Cycle = "NIGHTMARE";
            Number = 2054;

            Cards.Add(new Card()
            {
                Title = "Road to Rivendell Nightmare",
                Id = "1770122B-7F4B-424A-A714-A23DB128E355",
                CardType = Models.CardType.Nightmare_Setup,
                Text =
@"You are playing in Nightmare mode.

Forced: When an enemy with the ambush keyword engages a player during the quest phase, it contributes its Threat to the total Threat in the staging area until the end of the phase.",
                OppositeText =
@"Begin with the standard quest deck and encounter deck for the Road to Rivendell scenario.

Remove the following cards, in the specified quantities, from the standard encounter and quest deck:

1x Orc Outpost (quest stage 2)
2x Ruined Road
2x Barren Hills
1x Goblin Taskmaster
4x Black Uruks
3x Mountain Warg
3x Bitter Wind
2x Warg Lair
5x Goblin Spearman
2x Goblin Archer
2x Plundered Armoury

Add the new quest card in this Nightmare Deck to the normal quest deck, in stage order. Then, shuffle the encounter cards in this Nightmare Deck into the remainder of the standard Road to Rivendell encounter deck.

Finally, flip this setup card over and place it next to the quest deck. Its effect remains active throughout the game, which is now ready to begin.",
                EncounterSet = "Road to Rivendell Nightmare",
                Quantity = 1,
                Number = 1,
                Artist = Artist.Oleg_Saakyan,
                UpdateScenarioCards = (groups) =>
                {
                    foreach (var group in groups)
                    {
                        var scenario = group.Scenarios.Where(x => x.Title == "Road to Rivendell").FirstOrDefault();
                        if (scenario == null)
                            continue;

                        foreach (var quest in scenario.QuestCards)
                        {
                            switch (quest.Title)
                            {
                                case "Orc Outpost":
                                    quest.NightmareModeQuantity = 0;
                                    break;
                                case "Ambush in the Night":
                                    quest.NormalModeQuantity = 0;
                                    quest.EasyModeQuantity = 0;
                                    break;
                                default:
                                    break;
                            }
                        }

                        foreach (var card in scenario.ScenarioCards.Where(x => !x.EncounterSet.EndsWith(" Nightmare")))
                        {
                            switch (card.Title)
                            {
                                case "Orc Outpost":
                                    card.NightmareQuantity -= 1;
                                    break;
                                case "Ruined Road":
                                    card.NightmareQuantity -= 2;
                                    break;
                                case "Barren Hills":
                                    card.NightmareQuantity -= 2;
                                    break;
                                case "Goblin Taskmaster":
                                    card.NightmareQuantity -= 1;
                                    break;
                                case "Black Uruks":
                                    card.NightmareQuantity -= 4;
                                    break;
                                case "Mountain Warg":
                                    card.NightmareQuantity -= 3;
                                    break;
                                case "Bitter Wind":
                                    card.NightmareQuantity -= 3;
                                    break;
                                case "Warg Lair":
                                    card.NightmareQuantity -= 2;
                                    break;
                                case "Goblin Spearman":
                                    card.NightmareQuantity -= 5;
                                    break;
                                case "Goblin Archer":
                                    card.NightmareQuantity -= 2;
                                    break;
                                case "Plundered Armoury":
                                    card.NightmareQuantity -= 2;
                                    break;
                                default:
                                    break;
                            }
                        }
                    }

                    return true;
                }
            });
            Cards.Add(new Card()
            {
                Title = "Ambush in the Night",
                ScenarioTitle = "Road to Rivendell",
                Id = "2EC4C17D-CB7C-4B1A-94AB-A755644577C5",
                ImageType = Models.ImageType.Png,
                HasSecondImage = true,
                CardType = CardType.Quest,
                StageNumber = 2,
                QuestPoints = 12,
                Text =
@"When Revealed: Search the encounter deck, discard pile and victory display for Goblin Gate and add it to the staging area, if able. Shuffle the encounter discard pile into the encounter deck. Discard cards from the top of the encounter deck until X enemies have been discarded, where X is the number of players in the game. Reveal all enemies discarded by this effect.",
                OppositeText =
@"When Revealed: The first player loses control of Arwen Undómiel and attaches her to Goblin Gate (she is now guarded by Goblin Gate). While she is guarded, the first player cannot gain control of Arwen Undómiel.

Goblin Gate gets +1 quest point for each enemy engaged with a player.

Progress cannot be placed on this stage unless the players control Arwen Undómiel.",
                EncounterSet = "Road to Rivendell Nightmare",
                Quantity = 1,
                Number = 2,
                Artist = Artist.Oleg_Saakyan
            });
            Cards.Add(new Card()
            {
                Title = "Uruk Elf-stalker",
                Id = "4A8E8DDA-F44E-4DD5-AACE-3D4F7C4D22EA",
                ImageType = Models.ImageType.Png,
                CardType = CardType.Enemy,
                EngagementCost = 5,
                Threat = 3,
                Attack = 5,
                Defense = 3,
                HitPoints = 5,
                Traits = new List<string> { "Uruk.", "Orc." },
                Keywords = new List<string> { "Ambush." },
                Text = "Forced: When Uruk Elf-stalker attacks and destroys a character, deal 1 damage to Arwen Undómiel.",
                Shadow = "Shadow: Attacking enemy gets +2 Attack.",
                EncounterSet = "Road to Rivendell Nightmare",
                Quantity = 3,
                Number = 3,
                Artist = Artist.Anthony_Devine
            });
            Cards.Add(new Card()
            {
                Title = "Goblin Trapper",
                Id = "93C87E29-E9DF-4596-A65D-D776CCC8F4B0",
                ImageType = Models.ImageType.Png,
                CardType = CardType.Enemy,
                EngagementCost = 30,
                Threat = 3,
                Attack = 3,
                Defense = 2,
                HitPoints = 3,
                Traits = new List<string> { "Goblin.", "Orc." },
                Keywords = new List<string> { "Ambush." },
                Text = "Forced: After Goblin Trapper engages a player, that player must exhaust a character he controls.",
                Shadow = "Shadow: Add Goblin Trapper to the staging area.",
                EncounterSet = "Road to Rivendell Nightmare",
                Quantity = 3,
                Number = 4,
                Artist = Artist.Guillaume_Ducos
            });
            Cards.Add(new Card()
            {
                Title = "Raiding Party",
                Id = "EC66FDED-E287-4FE7-B536-B8A2CA51F767",
                ImageType = Models.ImageType.Png,
                CardType = CardType.Enemy,
                EngagementCost = 34,
                Threat = 2,
                Attack = 5,
                Defense = 1,
                HitPoints = 7,
                Traits = new List<string> { "Mountain.", "Orc." },
                Keywords = new List<string> { "Ambush." },
                Text = "Forced: After Raiding Party engages a player, each player discards the top card of the encounter deck, starting with the first player. Each player who discards an enemy with the ambush keyword must make an engagement check against that enemy.",
                EncounterSet = "Road to Rivendell Nightmare",
                Quantity = 2,
                Number = 5,
                Artist = Artist.Mark_Behm
            });
            Cards.Add(new Card()
            {
                Title = "Vicious Trackers",
                Id = "45F25FBC-4722-4C8E-9F06-F1D7E4AB27FA",
                ImageType = Models.ImageType.Png,
                CardType = CardType.Enemy,
                EngagementCost = 16,
                Threat = 1,
                Attack = 3,
                Defense = 2,
                HitPoints = 5,
                Traits = new List<string> { "Goblin.", "Orc." },
                Keywords = new List<string> { "Surge." },
                Text = "While Vicious Tracker is engaged with a player, that player is considered to have +20 threat for purposes of engagement checks only.",
                EncounterSet = "Road to Rivendell Nightmare",
                Quantity = 2,
                Number = 6,
                Artist = Artist.Lukasz_Jaskolski
            });
            Cards.Add(new Card()
            {
                Title = "Treacherous Bluffs",
                Id = "E9C28758-7EB8-4958-B324-2024D90B7DC6",
                ImageType = Models.ImageType.Png,
                CardType = CardType.Location,
                Threat = 1,
                QuestPoints = 7,
                Traits = new List<string> { "Hills." },
                Text = "Forced: When an engaged enemy with the ambush keyword engages a player, Treacherous Bluffs gets +2 Threat until the end of the phase.",
                Shadow = "Shadow: Excess damage dealt by this attack must be assigned to Arwen Undómiel.",
                EncounterSet = "Road to Rivendell Nightmare",
                Quantity = 3,
                Number = 7,
                Artist = Artist.Adam_Lane
            });
            Cards.Add(new Card()
            {
                Title = "Concealed Woods",
                Id = "E9DBE592-324F-4B1D-8FC3-F1B0A685AF02",
                ImageType = Models.ImageType.Png,
                CardType = CardType.Location,
                Threat = 4,
                QuestPoints = 4,
                Traits = new List<string> { "Forest." },
                Text = "While Concealed Woods is the active location, the first enemy with the ambush keyword revealed from the encounter deck each round gains surge.",
                Shadow = "Shadow: Attacking enemy gets +2 Attack if engaged with the first player.",
                EncounterSet = "Road to Rivendell Nightmare",
                Quantity = 3,
                Number = 8,
                Artist = Artist.Jake_Bullock
            });
            Cards.Add(new Card()
            {
                Title = "Tumultuous Assault",
                Id = "64653BB9-7682-4EAD-9892-29E305968F89",
                ImageType = Models.ImageType.Png,
                CardType = CardType.Treachery,
                Text = "When Revealed: Return each engaged enemy with the ambush keyword to the staging area. Each player makes engagement checks against each enemy in the staging area, as if it were the encounter phase. If there are no enemies with the ambush keyword in play, Tumultuous Assault gains surge.",
                EncounterSet = "Road to Rivendell Nightmare",
                Quantity = 2,
                Number = 9,
                Artist = Artist.Mark_Behm
            });
        }
    }
}